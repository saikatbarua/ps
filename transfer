# Get all subdirectories in the parent directory that match the YYYYMMDD format
$subDirectories = Get-ChildItem -Path $parentDirectory -Directory | Where-Object { $_.Name -match $regexPattern }

# Find subdirectories that contain at least one file with the specified substring in the filename
$matchingSubdirectories = $subDirectories | Where-Object {
    (Get-ChildItem -Path $_.FullName -File | Where-Object { $_.Name -like "*$fileSubstring*" }).Count -gt 0
}

# Sort the matching directories by name in descending order and select the most recent one
$mostRecentDirectory = $matchingSubdirectories | Sort-Object Name -Descending | Select-Object -First 1
